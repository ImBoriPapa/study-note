# 메모리 할당 및 사용 구조
![메모리할당](https://user-images.githubusercontent.com/98242564/207038974-5df89c5a-7c16-4fb8-9feb-67dcaf66c9fc.png)

### MySQL에서 사용되는 메모리 공간은 크게 글로벌 메모리 영역과 로컬 메모리 영역으로 구분
- 글로벌 메모리 영역의 모든 메모리 공간은 MySQL 서버가 시작되면서 운영체제로 부터 할당
- 운영체제에 따라 요청된 공간을 100% 할당해줄 수도 있고, 그 공간 만큼 예약해두고 조금씩 할당할 수 있음
- 각 운영체제의 메모리 할당 방식은 복잡하며 MySQL 서버가 사용하는 정확한 메모리의 양을 측정하는 것은 쉽지 않다.

> 글로벌 메모리 영역과 로컬 메모리 영역은 MySQL 서버 내에 존재하는 많은 스레드가 공유해서 사용하는 공간인지 여부에 따라 구분

### 글로벌 메모리 영역
- 일반적으로 클라이언트 스레드의 수와 무관하게 하나의 메모리 공간만 할당.
- 필요에 따라 2개 이상의 메모리 공간을 할당받을 수도 있지만 클라이언트의 스레드 수와 무관
- 생성된 글로벌 영역이 N개라도 모든 스레드에 의해 공유된다.
#### 대표적인 글로벌 메모리 영역
- 테이블 캐시
- InnoDB 버퍼 풀
- InnoDB 어댑티브 해시 인덱스
- InnoDB 리두 로그 버퍼

## 로컬 메모리 영역
- 세션 메모리 영역이라고도 표현
- MySQL 서버상에 존재하는 클라이언트 스레드가 쿼리를 처리하는 데 사용하는 메모리 영역
- 클라이언트 스레드가 사용하는 메모리 공간이라고 해서 클라이언트 메모리 영역이라고도 한다.
- 클라이언트와 MySQL 서버와의 커넥션을 세션이라고 하기 때문에 로컬 메모리 영역을 세션 메모리 영역이라고도 한다.
- 로컬 메모리는 각 클라이언트 스레드별로 독립적으로 할당되며 절대 공유되어 사용되자 않는 다는 특징이 있다.
- 일반적으로 글로벌 메모리 영역의 크기는 주의해서 설정
- 소트 버퍼와 같은 로컬 메모리 영역도 최악의 경우 MySQL 서버가 메모리 부족으로 멈춰 버릴 수 있기 때문에 적절한 메모리 공간을 설정하는 것이 중요하다.
- 각 쿼리의 용도별로 필요할 때만 공간이 할당 필요하지 않을 경우 MySQL이 메모리 공간을 할당조차 않을 수도 있다.
- 로컬 메모리 공간은 커넥션이 열려 있는 동안 계속 할당된 상태로 남아 있는 공간도 있다(커넥션 버퍼나 결과 버퍼)
- 쿼리를 실행하는 순간에만 할당했다가 다시 해제하는 (소트 버퍼나 조인 버퍼)가 있다.
#### 대표적인 로컬 메모리 영역
- 정렬 버퍼(sort buffer)
- 조인 버퍼
- 바이너리 로그 캐시
- 네트워크 버퍼